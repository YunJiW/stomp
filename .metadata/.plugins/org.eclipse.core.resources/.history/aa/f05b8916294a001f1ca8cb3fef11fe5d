package com.example.demo.Chat;

import org.springframework.messaging.handler.annotation.DestinationVariable;
import org.springframework.messaging.handler.annotation.MessageMapping;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.extern.slf4j.Slf4j;

@AllArgsConstructor
@Data
public class ChatDto {
	
	private long roomId;
	private long userId;
	private String message;
	private String time;
	private boolean isFirst;
	private int userProfile;

}

@MessageMapping("/chatroom/{id}")
@Slf4j
public void sendMessage(@DestinationVariable("id") Long id,ChatDto chatDTO) {
    log.info("chat {} send by {} to room number{}", chatDTO.getMessage(), chatDTO.getUserId(), chatDTO.getRoomId());
    chatService.saveMessage(chatDTO);
    // /sub/chatroom/{id}로 메세지 보냄
    template.convertAndSend("/sub/chatroom/" + chatDTO.getRoomId(), chatDTO);
}